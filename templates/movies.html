{% extends "layout.html" %}

{% block title %}Movie Frame Home{% endblock %}
{% block content %}
    <h1>Movie Frame Controls</h1>

    {% if movies %}        
            {% for movie in movies %}
                <div class="movie-item" data-movie-id="{{ movie.id }}">
                    {% if movie.isActive %}
                        <div class="active_status">‚ñ∂Ô∏è</div>
                    {% endif %}
                    <div class="movie-link"><a href="{{ url_for('movie', movie_id=movie.id) }}" title="{{ movie.video_path }}">{{ movie.video_path }}</a></div>
                    <button type="button" class="delete-btn" title="Delete movie" onclick="deleteMovie({{ movie.id }}, this)">üóëÔ∏è</button>
                </div>
            {% endfor %}
        
    {% else %}
        <p>No movies found. Add one from the <a href="{{ url_for('first_run') }}">first run</a> page.</p>
    {% endif %}

    <form action="{{ url_for('stop_playback') }}" method="post" style="margin-top: 1em;">
        <button type="submit">Stop Playback</button>
    </form>

    <div>
        <h2>System Info</h2>
        <ul>
            <li><strong>Total Disk:</strong> {{ disk_stats.total_gb }} GB</li>
            <li><strong>Used Disk:</strong> {{ disk_stats.used_gb }} GB</li>
            <li><strong>Free Disk:</strong> {{ disk_stats.free_gb }} GB</li>
            <li><strong>Video Directory Size:</strong> {{ video_dir_size }} GB</li>
        </ul>
    </div>

    <script>
    function deleteMovie(movieId, btn) {
        if (!confirm('Delete this movie?')) return;
        
        const row = btn.closest('.movie-item');
        btn.disabled = true;
        btn.textContent = '‚è≥';
        
        fetch('/delete_movie/' + movieId, { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    row.style.transition = 'opacity 0.3s';
                    row.style.opacity = '0';
                    setTimeout(() => row.remove(), 300);
                } else {
                    alert('Failed to delete movie');
                    btn.disabled = false;
                    btn.textContent = 'üóëÔ∏è';
                }
            })
            .catch(err => {
                alert('Error deleting movie: ' + err);
                btn.disabled = false;
                btn.textContent = 'üóëÔ∏è';
            });
    }
    </script>

{% endblock %}